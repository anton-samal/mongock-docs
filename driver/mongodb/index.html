<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Mongock Documentation">

    <title>Mongock Documentation</title>

    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" sizes="any" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link href="/styles/base-styles.css" rel="stylesheet" />
    <link href="/styles/content.css" rel="stylesheet" />
    <link href="/styles/layout.css" rel="stylesheet" />
    <link href="/styles/side-menu.css" rel="stylesheet" />
    <link href="/styles/util.css" rel="stylesheet" />
    <link href="/styles/prism-base16-ateliersulphurpool.light.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Fjalla+One|Roboto" rel="stylesheet" />
  </head>

  <body>

    <!-- Header navigation -->
    <header>
  <div class="page-max-width d-flex flex-space-between flex-content-center">
    <div class="d-flex flex-items-center ml-0 mr-auto">
      <a class="logo d-inline-flex flex-items-center" href="https://www.mongock.io">
        <span class="mr-12">Mongock</span>
        <p class="text-left">
          <img src="/images/logo.png" width="15%" alt="Mongock">
        </p>  
       </a>
    </div>

    <nav class="d-flex flex-items-center ml-auto mr-0">
      <a class="mr-24" href="/">
        Home
      </a>
      <a href="https://github.com/mongock/mongock" target="_blank" rel="nofolllow">
        <!-- Source: <https://github.com/encharm/Font-Awesome-SVG-PNG/blob/master/black/svg/github.svg> -->
<svg focusable="false" viewBox="0 0 1792 1792"><title>GitHub</title><path d="M896 128q209 0 385.5 103t279.5 279.5 103 385.5q0 251-146.5 451.5t-378.5 277.5q-27 5-40-7t-13-30q0-3 .5-76.5t.5-134.5q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-119-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-85-13.5q-45 113-8 204-79 87-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-39 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 88.5t.5 54.5q0 18-13 30t-40 7q-232-77-378.5-277.5t-146.5-451.5q0-209 103-385.5t279.5-279.5 385.5-103zm-477 1103q3-7-7-12-10-3-13 2-3 7 7 12 9 6 13-2zm31 34q7-5-2-16-10-9-16-3-7 5 2 16 10 10 16 3zm30 45q9-7 0-19-8-13-17-6-9 5 0 18t17 7zm42 42q8-8-4-19-12-12-20-3-9 8 4 19 12 12 20 3zm57 25q3-11-13-16-15-4-19 7t13 15q15 6 19-6zm63 5q0-13-17-11-16 0-16 11 0 13 17 11 16 0 16-11zm58-10q-2-11-18-9-16 3-14 15t18 8 14-14z"></path></svg>

        <span class="ml-8">GitHub</span>
      </a>
    </nav>
  </div>
</header>


    <!-- Main page content -->
    <main class="page-max-width">
      



<aside class="side-menu">
  <h2>Navigation</h2>
  <nav class="menu-root">
    
      
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/index.html">
        What is mongock
      </a>
    
  </h7>

      <nav class="What is mongock">
        
      </nav>
    
      
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/technical-overview/index.html">
        Technical overview
      </a>
    
  </h7>

      <nav class="Technical overview">
        
      </nav>
    
      
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/get-started/index.html">
        Get started
      </a>
    
  </h7>

      <nav class="Get started">
        
      </nav>
    
      
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/migration/index.html">
        Migration
      </a>
    
  </h7>

      <nav class="Migration">
        
      </nav>
    
      
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/runner/index.html">
        Runner
      </a>
    
  </h7>

      <nav class="Runner">
        
          
  
  <a class="menu-item "  href="/runner/standalone/index.html">
    Runner: standalone
  </a>

        
          
  
  <a class="menu-item "  href="/runner/springboot/index.html">
    Runner: springboot
  </a>

        
      </nav>
    
      
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/driver/index.html">
        Driver
      </a>
    
  </h7>

      <nav class="Driver">
        
          
  
  <a class="menu-item current-page"  href="/driver/mongodb/index.html">
    Driver: mongodb
  </a>

        
      </nav>
    
      
  
  <h7 class="menu-item">
    
      Features
    
  </h7>

      <nav class="Features">
        
          
  
  <a class="menu-item "  href="/features/transactions/index.html">
    Transactions
  </a>

        
          
  
  <a class="menu-item "  href="/features/events/index.html">
    Events
  </a>

        
          
  
  <a class="menu-item "  href="/features/legacy-migration/index.html">
    Legacy migration
  </a>

        
      </nav>
    
      
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/cli/index.html">
        Cli
      </a>
    
  </h7>

      <nav class="Cli">
        
          
  
  <a class="menu-item "  href="/cli/operations/index.html">
    Operations
  </a>

        
      </nav>
    
      
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/pro/index.html">
        Pro
      </a>
    
  </h7>

      <nav class="Pro">
        
          
  
  <a class="menu-item "  href="/pro/registration.html">
    Registration
  </a>

        
      </nav>
    
      
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/faq/index.html">
        Faq
      </a>
    
  </h7>

      <nav class="Faq">
        
      </nav>
    
      
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/roadmap/index.html">
        Roadmap
      </a>
    
  </h7>

      <nav class="Roadmap">
        
      </nav>
    
      
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/pending/index.html">
        Pending
      </a>
    
  </h7>

      <nav class="Pending">
        
      </nav>
    

  



            
    

  </nav>
</aside>

      <article>
        <p><div class="table-of-contents"><h2>Table of Contents</h2><ul><li><a href="#introduction">Introduction</a></li><li><a href="#mongodb-driver-options">MongoDB driver options</a></li><li><a href="#mongodb-configuration">MongoDB Configuration</a><ul><li><a href="#properties">Properties</a></li></ul></li><li><a href="#mongodb-springdata">MongoDB Springdata</a><ul><li><a href="#transactions">Transactions</a></li></ul></li><li><a href="#mongodb-native-drivers">MongoDB native drivers</a><ul><li><a href="#transactions">Transactions</a></li></ul></li><li><a href="#examples">Examples</a></li></ul></div></p>
<h2 id="introduction"><a class="header-anchor" href="#introduction">#</a> Introduction</h2>
<p>The concept of driver and how it works is already explained in the <a href="#technical-overview">technical-overview</a>] and <a href="#driver">driver</a> pages.</p>
<p>Here we explain how to use a driver with MongoDB and they different drivers Mongock provides.</p>
<hr>
<h2 id="mongodb-driver-options"><a class="header-anchor" href="#mongodb-driver-options">#</a> MongoDB driver options</h2>
<p><strong>There are 4 drivers in the MongoDB family driver:</strong></p>
<ul>
<li>org.mongodb » mongodb-driver-sync (<em>v4.x</em>)</li>
<li>org.mongodb » mongo-java-driver (<em>v3.x</em>)</li>
<li>org.springframework.data » spring-data-mongodb (<em>v3.x</em>)</li>
<li>org.springframework.data » spring-data-mongodb (<em>v2.x</em>)</li>
</ul>
<hr>
<h2 id="mongodb-configuration"><a class="header-anchor" href="#mongodb-configuration">#</a> MongoDB Configuration</h2>
<p>All the MongoDB drivers share the same configuration.</p>
<p class="tipAlt">When setting configuration via properties file, it must be prefixed by <b>mongock.mongo-db</b></p>
<h3 id="properties"><a class="header-anchor" href="#properties">#</a> Properties</h3>
<table>
<thead>
<tr>
<th>Property</th>
<th style="text-align:left">Description</th>
<th>Type</th>
<th style="text-align:center">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>writeConcern</strong></td>
<td style="text-align:left">Exactly the same MongoDB parameter <strong>write concren</strong>. For more information, visit the official MongoDB documentation for <a href="https://docs.mongodb.com/manual/reference/write-concern/">write concern</a>.</td>
<td>Object</td>
<td style="text-align:center">{w:<code>majority</code>,<br />wTimeoutMs: null,<br />j:true}</td>
</tr>
<tr>
<td><strong>readConcern</strong></td>
<td style="text-align:left">Exactly the same MongoDB parameter <strong>read concren</strong>. For more information, visit the official MongoDB documentation for <a href="https://docs.mongodb.com/manual/reference/read-concern/">read concern</a>.</td>
<td>String</td>
<td style="text-align:center"><code>majority</code></td>
</tr>
<tr>
<td><strong>readPreference</strong></td>
<td style="text-align:left">Exactly the same MongoDB parameter <strong>read preference</strong>. For more information, visit the official MongoDB documentation for <a href="https://docs.mongodb.com/manual/reference/read-preference/">read preference</a>.</td>
<td>String</td>
<td style="text-align:center"><code>primary</code></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="mongodb-springdata"><a class="header-anchor" href="#mongodb-springdata">#</a> MongoDB Springdata</h2>
<p>Mongock offers two  drivers for MongoDB springdata. The latest, version 3.x, and the previous major version 2.x, just for those who haven't upgraded yet.</p>
<ul>
<li>SpringDataMongoV3Driver</li>
<li>SpringDataMongoV2Driver</li>
</ul>
<p>These classes provide the same two static initializers</p>
<ul>
<li><strong>withDefaultLock</strong>(MongoTemplate mongoTemplate)</li>
<li><strong>withLockStrategy</strong>(MongoTemplate mongoTemplate, long lockAcquiredForMillis, long lockQuitTryingAfterMillis, long lockTryFrequencyMillis)</li>
</ul>
<h3 id="transactions"><a class="header-anchor" href="#transactions">#</a> Transactions</h3>
<p class="warningAlt"><b>THIS NEED TO BE FILLED</b></p>
<hr>
<h2 id="mongodb-native-drivers"><a class="header-anchor" href="#mongodb-native-drivers">#</a> MongoDB native drivers</h2>
<p>Mongock offers two  drivers for MongoDB native drivers. The latest, version Sync 4.x, and the previous major version 3.x, just for those who haven't upgraded yet.</p>
<ul>
<li>MongoSync4Driver</li>
<li>MongoCore3Driver</li>
</ul>
<p>These classes provide the same two static initializers</p>
<ul>
<li><strong>withDefaultLock</strong>(MongoClient mongoClient, String databaseName)</li>
<li><strong>withLockStrategy</strong>(MongoClient mongoClient, String databaseName, long lockAcquiredForMillis, long lockQuitTryingAfterMillis,long lockTryFrequencyMillis)</li>
</ul>
<h3 id="transactions-2"><a class="header-anchor" href="#transactions-2">#</a> Transactions</h3>
<p class="warningAlt"><b>THIS NEED TO BE FILLED</b></p>
<h2 id="examples"><a class="header-anchor" href="#examples">#</a> Examples</h2>
<h4 id="example-automatic-approach-with-properties-file"><a class="header-anchor" href="#example-automatic-approach-with-properties-file">#</a> Example automatic approach with properties file</h4>
<p class="successAlt">This approach is only possible with Springdata drivers and assumes the MongoTemplate is injected in the Spring context</p>
<pre class="language-yaml"><code class="language-yaml"><div class="highlight-line"><span class="token key atrule">mongock</span><span class="token punctuation">:</span></div><div class="highlight-line">  <span class="token key atrule">mongo-db</span><span class="token punctuation">:</span></div><div class="highlight-line">    <span class="token key atrule">write-concern</span><span class="token punctuation">:</span></div><div class="highlight-line">      <span class="token key atrule">w</span><span class="token punctuation">:</span> majority</div><div class="highlight-line">      <span class="token key atrule">wTimeoutMs</span><span class="token punctuation">:</span> <span class="token number">1000</span></div><div class="highlight-line">      <span class="token key atrule">journal</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></div><div class="highlight-line">    <span class="token key atrule">read-concern</span><span class="token punctuation">:</span> majority</div><div class="highlight-line">    <span class="token key atrule">read-preference</span><span class="token punctuation">:</span> primary</div></code></pre>
<h4 id="example-with-builder"><a class="header-anchor" href="#example-with-builder">#</a> Example with builder</h4>
<pre class="language-java"><code class="language-java"><div class="highlight-line"><span class="token comment">//this could be the SpringDataMongoV2Driver passing the same paremeter or MongoSync4Driver/MongoCore3Driver passing the MongoClient and databaseName</span></div><div class="highlight-line"><span class="token class-name">SpringDataMongoV3Driver</span> driver <span class="token operator">=</span> <span class="token class-name">SpringDataMongoV3Driver</span><span class="token punctuation">.</span><span class="token function">withDefaultLock</span><span class="token punctuation">(</span>mongoTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="highlight-line">driver<span class="token punctuation">.</span><span class="token function">setWriteConcern</span><span class="token punctuation">(</span><span class="token class-name">WriteConcern</span><span class="token punctuation">.</span>MAJORITY<span class="token punctuation">.</span><span class="token function">withJournal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withWTimeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="highlight-line">driver<span class="token punctuation">.</span><span class="token function">setReadConcern</span><span class="token punctuation">(</span><span class="token class-name">ReadConcern</span><span class="token punctuation">.</span>MAJORITY<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="highlight-line">driver<span class="token punctuation">.</span><span class="token function">setReadPreference</span><span class="token punctuation">(</span><span class="token class-name">ReadPreference</span><span class="token punctuation">.</span><span class="token function">primary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre>

      </article>
    </main>

    <!-- Footer -->
    <footer>
  <nav class="page-max-width d-flex flex-space-evenly flex-items-center">
    <a class="d-inline-flex flex-center flex-items-center" href="https://www.mongock.io">Mongock</a>
    <div class="d-flex flex-center flex-items-center">
      <a class="d-inline-flex flex-items-center mr-16" href="https://github.com/mongock/mongock" target="_blank" rel="nofollow">
        <!-- Source: <https://github.com/encharm/Font-Awesome-SVG-PNG/blob/master/black/svg/github.svg> -->
<svg focusable="false" viewBox="0 0 1792 1792"><title>GitHub</title><path d="M896 128q209 0 385.5 103t279.5 279.5 103 385.5q0 251-146.5 451.5t-378.5 277.5q-27 5-40-7t-13-30q0-3 .5-76.5t.5-134.5q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-119-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-85-13.5q-45 113-8 204-79 87-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-39 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 88.5t.5 54.5q0 18-13 30t-40 7q-232-77-378.5-277.5t-146.5-451.5q0-209 103-385.5t279.5-279.5 385.5-103zm-477 1103q3-7-7-12-10-3-13 2-3 7 7 12 9 6 13-2zm31 34q7-5-2-16-10-9-16-3-7 5 2 16 10 10 16 3zm30 45q9-7 0-19-8-13-17-6-9 5 0 18t17 7zm42 42q8-8-4-19-12-12-20-3-9 8 4 19 12 12 20 3zm57 25q3-11-13-16-15-4-19 7t13 15q15 6 19-6zm63 5q0-13-17-11-16 0-16 11 0 13 17 11 16 0 16-11zm58-10q-2-11-18-9-16 3-14 15t18 8 14-14z"></path></svg>

      </a>
      <a class="d-inline-flex flex-items-center" href="https://twitter.com/mongock" target="_blank" rel="nofollow">
        <!-- Source: <https://github.com/encharm/Font-Awesome-SVG-PNG/blob/master/black/svg/twitter.svg> -->
<svg focusable="false" viewBox="0 0 1792 1792"><title>Twitter</title><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"></path></svg>

      </a>
    </div>
    <a class="d-inline-flex flex-center flex-items-center" href="https://github.com/mongock/mongock/issues" target="_blank" rel="nofollow">
      <!-- Source: <https://octicons.github.com/icon/issue-opened/> -->
<svg viewBox="0 0 14 16" version="1.1" width="112" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>

      <span class="ml-8">Issues</span>
    </a>
  </nav>
</footer>


  </body>
</html>
